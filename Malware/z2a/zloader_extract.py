from arc4 import ARC4
import pefile
import re
import binascii


def rc4_decrypt(key, data):
    cipher = ARC4(key, data)
    return cipher.decrypt(data)

def locate_config_key(data):
    pattern = "[a-z]{20}"
    match_object = re.search(pattern, data)
    key = data[match_object.start(): match_object.end()]
    config = data[match_object.start()-751: match_object.start()]
    return config, key

def retrieve_config(filename):
    pe = pefile.PE(filename)
    for section in pe.sections():
        if ".data" in section.Name:
            data_section = section.get_data()
            break
        data_section = data_section[4:]
        return locate_config_key(data_section)


def main():
    filename = raw_input("Filename: ")
    encrypted_config, key = retrieve_config(filename)
    print(rc4_decrypt(key, encrypted_config))

if __name__ == "__main__":
    main()
